<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ğŸ§  Test: Claude + Sandra</title>
  <style>
    body { background: #0f0f0f; color: #fff; font-family: sans-serif; padding: 20px; }
    .card { background: #1a1a1a; padding: 20px; margin: 10px 0; border-radius: 8px; }
    button { background: #1e88e5; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #1976d2; }
    pre { background: #222; padding: 12px; border-radius: 6px; overflow-x: auto; }
    .status { padding: 8px; margin: 8px 0; border-radius: 4px; }
    .success { background: #2e7d32; }
    .error { background: #c62828; }
  </style>
</head>
<body>
  <h1>ğŸ”§ Test de IntegraciÃ³n: Claude Local</h1>

  <div class="card">
    <h3>1. ğŸ› ï¸ Setup automÃ¡tico (1 clic)</h3>
    <button onclick="setup()">Obtener cookies de Claude</button>
    <div id="setup-status"></div>
  </div>

  <div class="card">
    <h3>2. ğŸ§ª Probar Claude</h3>
    <button onclick="testClaude()">Enviar: "Resume la teorÃ­a de la relatividad en 1 lÃ­nea"</button>
    <div id="test-result"></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    // Escuchar resultado del setup
    ipcRenderer.on('claude-setup', (event, data) => {
      const el = document.getElementById('setup-status');
      if (data.status === 'success') {
        el.innerHTML = `<div class="status success">âœ… Cookies guardadas en: ${data.file}</div>`;
      } else if (data.status === 'already_setup') {
        el.innerHTML = `<div class="status success">âœ… Ya estÃ¡ configurado</div>`;
      } else {
        el.innerHTML = `<div class="status error">âŒ FallÃ³: ${data.reason}</div>`;
      }
    });

    async function setup() {
      ipcRenderer.send('trigger-claude-setup');
    }

    async function testClaude() {
      const el = document.getElementById('test-result');
      el.innerHTML = '<div class="status">â³ Enviando a Claude...</div>';
      
      try {
        const { useClaude } = await import('./orchestrator/claude-bridge.js');
        const res = await useClaude("Resume la teorÃ­a de la relatividad en 1 lÃ­nea", { fallbackToQwen: false });
        
        if (res.success) {
          el.innerHTML = `
            <div class="status success">âœ… ${res.source} respondiÃ³:</div>
            <pre>${res.answer}</pre>
            <small>Chat ID: ${res.chatId}</small>
          `;
        } else {
          el.innerHTML = `<div class="status error">âŒ Error: ${res.error}</div>`;
        }
      } catch (e) {
        el.innerHTML = `<div class="status error">ğŸ’¥ ExcepciÃ³n: ${e.message}</div>`;
      }
    }
  </script>
</body>
</html>