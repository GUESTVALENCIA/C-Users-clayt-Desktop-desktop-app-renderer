# Configuración Apache para sandra.guestsvalencia.es
# Coloca este archivo en /etc/apache2/sites-available/sandra.guestsvalencia.es.conf

<VirtualHost *:80>
    ServerName sandra.guestsvalencia.es
    ServerAlias www.sandra.guestsvalencia.es
    
    DocumentRoot /var/www/sandra.guestsvalencia.es
    
    <Directory /var/www/sandra.guestsvalencia.es>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Rewrite para SPA
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Cache para archivos estáticos
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|otf)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, immutable"
    </LocationMatch>

    # Service Worker - sin cache
    <LocationMatch "^/sw\.js$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </LocationMatch>

    # HTML - sin cache
    <LocationMatch "\.html$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </LocationMatch>

    # Seguridad
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/sandra-error.log
    CustomLog ${APACHE_LOG_DIR}/sandra-access.log combined
</VirtualHost>

# Configuración HTTPS (descomentar después de configurar SSL)
# <VirtualHost *:443>
#     ServerName sandra.guestsvalencia.es
#     ServerAlias www.sandra.guestsvalencia.es
#     
#     DocumentRoot /var/www/sandra.guestsvalencia.es
#     
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/sandra.guestsvalencia.es/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/sandra.guestsvalencia.es/privkey.pem
#     
#     <Directory /var/www/sandra.guestsvalencia.es>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#         RewriteEngine On
#         RewriteBase /
#         RewriteRule ^index\.html$ - [L]
#         RewriteCond %{REQUEST_FILENAME} !-f
#         RewriteCond %{REQUEST_FILENAME} !-d
#         RewriteRule . /index.html [L]
#     </Directory>
#     
#     ErrorLog ${APACHE_LOG_DIR}/sandra-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/sandra-ssl-access.log combined
# </VirtualHost>
